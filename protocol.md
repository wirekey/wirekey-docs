## 2. Cryptographic Dependencies

## 2.1. Secret Combination

High-entropy master secrets are derived from two partial secrets using the `CombineSecrets` function defined below:

```
CombineSecrets(Secret1, Secret2) = HKDF-Extract(salt: Secret1, ikm: Secret2)
```

where the function `HKDF-Extract` is defined in [RFC5869] and instantiated with SHA-256, 

### 2.2. Key Derivation
Cryptographic keys are derived from a high-entropy input secret using the `DeriveKey` function defined below:

```
DeriveKey(Secret, Label, Context, Length) = HKDF-Expand(prk: Secret, info: HKDFLabel, length: Length)
```

where the function `HKDF-Expand` is defined in [RFC5869] and instantiated with SHA-256.

`HKDFLabel` is defined as:

```
struct {
    uint16 length;
    opaque label<V>;
    opaque context<V>;
} HKDFLabel;
```

and its fields are set to:

```
length = Length;
label = "WireKey 1.0 " + Label;
context = Context;
```

### 2.3. Authenticated Encryption

Authenticated Encryption with Associated Data (AEAD) is provided by the AES_256_GCM algorithm, as defined in [RFC5116], Section 5.1.

Encryption is defined as:

```
AEADEncrypt(Key, Plaintext) = Nonce || AEAD-Encrypt(Key, Nonce, aad: "", Plaintext)
```

where Nonce is a 12-octet value generated by a cryptographically secure random number generator. Nonces MUST be unique for each (Key, Nonce) pair; reuse of a nonce with the same key causes a catastrophic loss of confidentiality and integrity. The output consists of the nonce concatenated with the ciphertext and authentication tag, as specified in [RFC5116].


Decryption is defined as:
```
AEADDecrypt(Key, Payload) = AEAD-Decrypt(Key, Nonce, aad: "", Ciphertext)
```

where Payload is parsed as:

```
Nonce      = Payload[0..11]
Ciphertext = Payload[12..]
```

Decryption returns the original plaintext if authentication succeeds and produces an error otherwise.

### 2.3. Hybrid Public Key Encryption

Hybrid Public Key Encryption (HPKE) in Base mode is used to encrypt data to a recipient public key. To ensure cryptographic separation, all operations include a distinct `Label` and a `Context` string. The encryption and decryption are done as follows:

`HPKEEncrypt(PublicKey, Label, Context, Plaintext) = SealBase(PublicKey, HPKEContext, aad: "", Plaintext)`

`HPKEDecrypt(PrivateKey, Label, Context, KEMOutput, Ciphertext) = OpenBase(KEMOutput, PrivateKey, HPKEContext, aad: "", Ciphertext)`

where `HPKEEncrypt` returns two values, `(KEMOutput, Ciphertext)`, as specified in [RFC9180].

`HPKEContext` is specified as:

```
struct {
  opaque label<V>;
  opaque context<V>;
} HPKEContext;
```

and its fields are set to:

```
label = "WireKey 1.0 HPKE " + Label;
context = Context;
```

The underlying functions `SealBase` and `OpenBase` are defined in [RFC 9180] and implemented using the following cryptographic components:

- KEM:  DHKEM(X25519)
- KDF:  HKDF-SHA256
- AEAD: AES-256-GCM

## 2.4. Digital Signatures

Digital signatures are used to provide data integrity and to authenticate the origin of data. The abstractions below are based on the model defined in [RFC 9420]:

`Sign(SigningKey, Label, Content) = Signature.Sign(SigningKey, SignContent)`

`Verify(VerificationKey, Label, Content, SignatureValue) = Signature.Verify(VerificationKey, SignContent, SignatureValue)`

Where `SignContent` is specified as:

```
struct {
  opaque label<V>;
  opaque content<V>;
} SignContent;
```

And its fields are set to:

```
label = "WireKey 1.0 " + Label;
content = Content;
```

The underlying `Signature.Sign` and `Signature.Verify` functions are implemented using the Edwards-curve Digital Signature Algorithm (EdDSA) with the Ed25519 curve, as defined in ()[RFC8032].

## References

[RFC5869] Krawczyk, H. and P. Eronen, "HMAC-based Extract-and-Expand Key Derivation Function (HKDF)", RFC 5869, May 2010.  
[RFC8032] Josefsson, S. and I. Liusvaara, "Edwards-Curve Digital Signature Algorithm (EdDSA)", RFC 8032, January 2017.  
[RFC9180] Barnes, R., Bhargavan, K., Lipp, B., et al., "Hybrid Public Key Encryption", RFC 9180, April 2022.  
[RFC9420] Barnes, R., Beurdouche, B., Robert, R., et al., "The Messaging Layer Security (MLS) Protocol", RFC 9420, July 2023.  
[RFC5116] McGrew, D., "An Interface and Algorithms for Authenticated Encryption", RFC 5116, January 2008.  
[RFC8446] Rescorla, E., "The Transport Layer Security (TLS) Protocol Version 1.3", RFC 8446, August 2018.  